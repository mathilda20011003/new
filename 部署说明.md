# 微信公众号AI摘要爬虫部署说明

## 📋 部署概述

本项目已配置为使用GitHub Actions自动运行，每天早上10点（北京时间）自动推送微信公众号AI摘要到飞书群组。

## 🚀 部署步骤

### 1. 推送代码到GitHub仓库

将当前的所有修改推送到您的GitHub仓库：

```bash
git add .
git commit -m "更新微信公众号AI摘要爬虫，修复时间显示和格式问题"
git push origin main
```

### 2. 配置GitHub Secrets

在GitHub仓库中设置以下Secrets（Settings → Secrets and variables → Actions）：

#### 必需的Secrets：

1. **FEISHU_WEBHOOK_URL**
   - 值：您的飞书工作流Webhook URL
   - 示例：`https://www.feishu.cn/flow/api/trigger-webhook/xxxxxxxxxxxxxxxx`

2. **OPENROUTER_API_KEY**
   - 值：您的OpenRouter API密钥
   - 示例：`sk-or-v1-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

3. **WEWE_RSS_BASE_URL**
   - 值：您的WeWe RSS服务地址
   - 示例：`https://ssys2025.zeabur.app`

#### 可选的Secrets：

4. **AI_MODEL**（可选）
   - 值：AI模型名称
   - 默认：`google/gemini-2.5-flash-lite-preview-09-2025`

### 3. 验证配置文件

确保以下配置文件正确：

- `config/wechat_accounts.yaml` - 公众号配置
- `.env.example` - 环境变量示例

## ⏰ 运行时间配置

### 当前设置
- **自动运行时间**：每天早上10:00（北京时间）
- **对应UTC时间**：每天02:00 UTC

### 修改运行时间

如需修改运行时间，编辑 `.github/workflows/wechat-crawler.yml` 文件中的cron表达式：

```yaml
schedule:
  - cron: '0 2 * * *'  # UTC时间，对应北京时间10:00
```

**时间对照表**：
- 北京时间 08:00 = UTC 00:00 → `'0 0 * * *'`
- 北京时间 09:00 = UTC 01:00 → `'0 1 * * *'`
- 北京时间 10:00 = UTC 02:00 → `'0 2 * * *'`
- 北京时间 11:00 = UTC 03:00 → `'0 3 * * *'`

## 🔧 手动触发

### 方法1：GitHub网页界面

1. 打开您的GitHub仓库
2. 点击 **Actions** 标签
3. 在左侧选择 **WeChat AI Summary Crawler**
4. 点击右侧的 **Run workflow** 按钮
5. 选择分支（通常是main）
6. 点击绿色的 **Run workflow** 按钮

### 方法2：GitHub CLI（命令行）

如果您安装了GitHub CLI：

```bash
# 安装GitHub CLI（如果未安装）
# Windows: winget install GitHub.cli
# macOS: brew install gh

# 登录GitHub
gh auth login

# 手动触发工作流
gh workflow run "WeChat AI Summary Crawler"

# 查看工作流运行状态
gh run list --workflow="WeChat AI Summary Crawler"
```

### 方法3：API调用

使用GitHub API手动触发：

```bash
curl -X POST \
  -H "Accept: application/vnd.github.v3+json" \
  -H "Authorization: token YOUR_GITHUB_TOKEN" \
  https://api.github.com/repos/YOUR_USERNAME/YOUR_REPO/actions/workflows/wechat-crawler.yml/dispatches \
  -d '{"ref":"main"}'
```

## 📊 监控和日志

### 查看运行日志

1. 进入GitHub仓库的 **Actions** 页面
2. 点击具体的工作流运行记录
3. 展开各个步骤查看详细日志

### 常见问题排查

1. **API密钥错误**：检查Secrets中的API密钥是否正确
2. **飞书推送失败**：检查飞书Webhook URL是否有效
3. **RSS获取失败**：检查WeWe RSS服务是否正常运行
4. **时间解析错误**：查看日志中的时间解析错误信息

## 🔄 禁用原新闻爬虫

原来的新闻爬虫已被禁用（`crawler.yml`），避免与新的微信公众号摘要冲突。如需重新启用，请：

1. 编辑 `.github/workflows/crawler.yml`
2. 取消注释 `schedule` 部分
3. 推送更改到仓库

## 📝 配置文件说明

### config/wechat_accounts.yaml

```yaml
accounts:
  - name: "公众号名称"
    feed_id: "MP_WXS_123456"  # WeWe RSS中的Feed ID
    keywords:
      - "关键词1"
      - "关键词2"
```

### 获取Feed ID

1. 在WeWe RSS中添加公众号
2. 添加成功后复制显示的Feed ID
3. 将Feed ID填入配置文件

## 🎯 部署完成检查

部署完成后，请检查：

1. ✅ GitHub Secrets已正确配置
2. ✅ 工作流文件已更新
3. ✅ 配置文件格式正确
4. ✅ 手动触发测试成功
5. ✅ 飞书群组收到测试消息

## 📞 技术支持

如遇到问题，请检查：
1. GitHub Actions运行日志
2. 飞书工作流配置
3. WeWe RSS服务状态
4. API密钥有效性
